openapi: 3.1.0
info:
  title: Marketplace API
  version: 0.3.0
servers:
  - url: /api/v1
paths:
  /health:
    get:
      summary: API health check
      responses:
        "200":
          description: Service status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"

  /catalog/categories:
    get:
      summary: List buyer-facing catalog categories
      responses:
        "200":
          description: Available categories

  /catalog/products:
    get:
      summary: List publicly visible products
      parameters:
        - in: query
          name: q
          schema:
            type: string
        - in: query
          name: category
          schema:
            type: string
        - in: query
          name: vendor
          schema:
            type: string
        - in: query
          name: price_min
          schema:
            type: integer
        - in: query
          name: price_max
          schema:
            type: integer
        - in: query
          name: min_rating
          schema:
            type: number
        - in: query
          name: sort
          schema:
            type: string
            enum: [relevance, newest, price_low_high, price_high_low, rating]
        - in: query
          name: limit
          schema:
            type: integer
        - in: query
          name: offset
          schema:
            type: integer
      responses:
        "200":
          description: Visible approved products from verified vendors

  /catalog/products/{productID}:
    get:
      summary: Get buyer-facing product detail
      parameters:
        - in: path
          name: productID
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Product detail

  /auth/register:
    post:
      summary: Register a user account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthRequest"
      responses:
        "201":
          description: Account created

  /auth/login:
    post:
      summary: Login user and issue tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthRequest"
      responses:
        "200":
          description: Login success

  /auth/refresh:
    post:
      summary: Rotate refresh token and issue new token pair
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthRefreshRequest"
      responses:
        "200":
          description: Token refresh success

  /auth/me:
    get:
      summary: Get authenticated user profile
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Authenticated profile

  /auth/logout:
    post:
      summary: Revoke active session
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Session revoked

  /vendors/register:
    post:
      summary: Register vendor profile for authenticated user
      security:
        - bearerAuth: []
      responses:
        "201":
          description: Vendor created

  /vendor/verification-status:
    get:
      summary: Fetch authenticated vendor verification status
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Vendor status

  /vendor/products:
    post:
      summary: Create vendor product draft
      security:
        - bearerAuth: []
      responses:
        "201":
          description: Product created

  /vendor/products/{productID}/submit-moderation:
    post:
      summary: Submit product for moderation review
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: productID
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Product submitted

  /admin/vendors/{vendorID}/verification:
    patch:
      summary: Update vendor verification state
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: vendorID
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Verification updated

  /admin/vendors/{vendorID}/commission:
    patch:
      summary: Set vendor commission override in basis points
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: vendorID
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Commission updated

  /admin/moderation/products/{productID}:
    patch:
      summary: Approve or reject a pending product
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: productID
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Product moderated

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
        service:
          type: string
        timestamp:
          type: string
          format: date-time
      required: [status, service, timestamp]

    AuthRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
      required: [email, password]

    AuthRefreshRequest:
      type: object
      properties:
        refresh_token:
          type: string
      required: [refresh_token]
